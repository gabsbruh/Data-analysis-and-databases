<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>readme</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="readme_files/libs/clipboard/clipboard.min.js"></script>
<script src="readme_files/libs/quarto-html/quarto.js"></script>
<script src="readme_files/libs/quarto-html/popper.min.js"></script>
<script src="readme_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="readme_files/libs/quarto-html/anchor.min.js"></script>
<link href="readme_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="readme_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="readme_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="readme_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="readme_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">



<p><a href="https://classroom.github.com/a/jQ49mxG9"><img src="https://classroom.github.com/assets/deadline-readme-button-24ddc0f5d75046c5622901739e7c5dd533143b0c8e959d652212380cedb1ea36.svg" class="img-fluid" alt="Review Assignment Due Date"></a> <a href="https://classroom.github.com/online_ide?assignment_repo_id=12582518&amp;assignment_repo_type=AssignmentRepo"><img src="https://classroom.github.com/assets/open-in-vscode-718a45dd9cf7e7f842a935f5ebbe5719a5e09af4491e668f4dbf3b35d5cca122.svg" class="img-fluid" alt="Open in Visual Studio Code"></a> # Łączenie tabel i podzapytania</p>
<section id="przykładowe-tabele-obrazujące-łączenie" class="level2">
<h2 class="anchored" data-anchor-id="przykładowe-tabele-obrazujące-łączenie">Przykładowe tabele obrazujące łączenie</h2>
<p>Do zobrazowania operacji łączenia zostaną użyte tabele:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> shape_a ( <span class="kw">id</span> <span class="dt">INT</span> <span class="kw">PRIMARY</span> <span class="kw">KEY</span>, shape <span class="dt">VARCHAR</span> (<span class="dv">100</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>);</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> shape_b ( <span class="kw">id</span> <span class="dt">INT</span> <span class="kw">PRIMARY</span> <span class="kw">KEY</span>, shape <span class="dt">VARCHAR</span> (<span class="dv">100</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Polecenie CREATE TABLE tworzy tabelę o zadanej nazwie i strukturze. Ogólna postać to:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> tab_name ( col_name1 data_type constrain, col_name1</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>data_type constrain, <span class="op">..</span>. );</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Należy uzupełnić ją danymi:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> shape_a (<span class="kw">id</span>, shape) <span class="kw">VALUES</span> (<span class="dv">1</span>, <span class="st">'Trójkąt'</span>), (<span class="dv">2</span>, <span class="st">'Kwadrat'</span>), (<span class="dv">3</span>, <span class="st">'Deltoid'</span>), (<span class="dv">4</span>, <span class="st">'Traper'</span>);</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> shape_b (<span class="kw">id</span>, shape) <span class="kw">VALUES</span> (<span class="dv">1</span>, <span class="st">'Kwadrat'</span>), (<span class="dv">2</span>, <span class="st">'Trójkąt'</span>), (<span class="dv">3</span>, <span class="st">'Romb'</span>), (<span class="dv">4</span>, <span class="st">'Równoległobok'</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Komenda INSERT INTO pozwala na dodanie do tabeli rekordów. Ogólna postać to:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> tab_name (col1_name, col2_name2, <span class="op">..</span>.) <span class="kw">VALUES</span> (val1_col1,</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>val2_col2), (val2_col1, val2_col2), <span class="op">..</span>.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="inner-join" class="level2">
<h2 class="anchored" data-anchor-id="inner-join">Inner join</h2>
<p>Jest to podstawowy rodzaj złączenie. Ten sposób złączenia wybiera te wiersze, dla których warunek złączenia jest spełniony. W żadnej z łączonych tabel kolumna użyta do łączenia nie może mieć wartości NULL.</p>
<section id="przykład" class="level4">
<h4 class="anchored" data-anchor-id="przykład">Przykład:</h4>
<div class="sourceCode" id="cb5"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> a.<span class="kw">id</span> id_a, a.shape shape_a, b.<span class="kw">id</span> id_b, b.shape shape_b </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> shape_a a <span class="kw">INNER</span> <span class="kw">JOIN</span> shape_b b <span class="kw">ON</span> a.shape <span class="op">=</span> b.shape;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>W zapytaniu powyżej użyto <em>aliasów</em> nazw tabel i column wynikowych, jest to szczególnie przydatne przy długich nazwach tabel i wprowadza czytelność w zapytaniu.</p>
</section>
<section id="wynik" class="level4">
<h4 class="anchored" data-anchor-id="wynik">Wynik:</h4>
<table class="table">
<thead>
<tr class="header">
<th>id_a</th>
<th>shape_a</th>
<th>id_b</th>
<th>shape_b</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Trójkąt</td>
<td>2</td>
<td>Trójkąt</td>
</tr>
<tr class="even">
<td>2</td>
<td>Kwadrat</td>
<td>1</td>
<td>Kwadrat</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="outer-join" class="level2">
<h2 class="anchored" data-anchor-id="outer-join">OUTER JOIN</h2>
<p>Istnieją trzy rodzaje złączeń OUTER: - LEFT OUTER JOIN, - RIGHT OUTER JOIN, - FULL OUTER JOIN.</p>
<section id="left-outer-join" class="level3">
<h3 class="anchored" data-anchor-id="left-outer-join">LEFT OUTER JOIN</h3>
<p>Ten rodzaj złączenie zwróci wszystkie rekordy z lewej tablicy i dopasuje do nich rekordy z prawej tablicy które spełniją zadany warunek złączenia. Jeżeli w prawej tablicy nie występują rekordy spełnijące warunek złączenia z lewą w ich miejscu pojawią się wartości NULL.</p>
<section id="przykład-1" class="level4">
<h4 class="anchored" data-anchor-id="przykład-1">Przykład 1:</h4>
<div class="sourceCode" id="cb6"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> a.<span class="kw">id</span> id_a, a.shape shape_a, b.<span class="kw">id</span> id_b, b.shape shape_b </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> shape_a a <span class="kw">LEFT</span> <span class="kw">JOIN</span> shape_b b <span class="kw">ON</span> a.shape <span class="op">=</span> b.shape;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="wynik-1" class="level4">
<h4 class="anchored" data-anchor-id="wynik-1">Wynik:</h4>
<table class="table">
<thead>
<tr class="header">
<th>id_a</th>
<th>shape_a</th>
<th>id_b</th>
<th>shape_b</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Trójkąt</td>
<td>2</td>
<td>Trójkąt</td>
</tr>
<tr class="even">
<td>2</td>
<td>Kwadrat</td>
<td>1</td>
<td>Kwadrat</td>
</tr>
<tr class="odd">
<td>3</td>
<td>Deltoid</td>
<td>NULL</td>
<td>NULL</td>
</tr>
<tr class="even">
<td>4</td>
<td>Traper</td>
<td>NULL</td>
<td>NULL</td>
</tr>
</tbody>
</table>
</section>
<section id="przykład-2" class="level4">
<h4 class="anchored" data-anchor-id="przykład-2">Przykład 2:</h4>
<div class="sourceCode" id="cb7"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> b.<span class="kw">id</span> id_b, b.shape shape_b, a.<span class="kw">id</span> id_a, a.shape shape_a</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> shape_b b <span class="kw">LEFT</span> <span class="kw">JOIN</span> shape_a a <span class="kw">ON</span> a.shape <span class="op">=</span> b.shape;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="wynik-2" class="level4">
<h4 class="anchored" data-anchor-id="wynik-2">Wynik:</h4>
<table class="table">
<thead>
<tr class="header">
<th>id_a</th>
<th>shape_a</th>
<th>id_b</th>
<th>shape_b</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Kwadrat</td>
<td>2</td>
<td>Kwadrat</td>
</tr>
<tr class="even">
<td>2</td>
<td>Trójkąt</td>
<td>1</td>
<td>Trójkąt</td>
</tr>
<tr class="odd">
<td>3</td>
<td>Romb</td>
<td>NULL</td>
<td>NULL</td>
</tr>
<tr class="even">
<td>4</td>
<td>Równoległobok</td>
<td>NULL</td>
<td>NULL</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="right-outer-join" class="level3">
<h3 class="anchored" data-anchor-id="right-outer-join">RIGHT OUTER JOIN</h3>
<p>Działa jak left outer join z tym, że prawa tablica w zapytaniu jest brana w całości.</p>
<section id="przykład-3" class="level4">
<h4 class="anchored" data-anchor-id="przykład-3">Przykład:</h4>
<div class="sourceCode" id="cb8"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> a.<span class="kw">id</span> id_a, a.shape shape_a, b.<span class="kw">id</span> id_b, b.shape shape_b </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> shape_a a <span class="kw">RIGHT</span> <span class="kw">JOIN</span> shape_b b <span class="kw">ON</span> a.shape <span class="op">=</span> b.shape;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="wynik-3" class="level4">
<h4 class="anchored" data-anchor-id="wynik-3">Wynik:</h4>
<table class="table">
<thead>
<tr class="header">
<th>id_a</th>
<th>shape_a</th>
<th>id_b</th>
<th>shape_b</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
<td>Kwadrat</td>
<td>1</td>
<td>Kwadrat</td>
</tr>
<tr class="even">
<td>1</td>
<td>Trójkąt</td>
<td>2</td>
<td>Trójkąt</td>
</tr>
<tr class="odd">
<td>NULL</td>
<td>NULL</td>
<td>3</td>
<td>Romb</td>
</tr>
<tr class="even">
<td>NULL</td>
<td>NULL</td>
<td>4</td>
<td>Równoległobok</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="full-outer-join" class="level3">
<h3 class="anchored" data-anchor-id="full-outer-join">FULL OUTER JOIN</h3>
<p>Jest złączeniem które zwraca: - wiersze dla których warunek złączenia jest spełniony, - wiersze z lewej tabeli dla których nie ma odpowiedników w prawej, - wiersze z prawej tabeli dla których nie ma odpowiedników w lewej.</p>
<section id="przykład-4" class="level4">
<h4 class="anchored" data-anchor-id="przykład-4">Przykład:</h4>
<div class="sourceCode" id="cb9"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> a.<span class="kw">id</span> id_a, a.shape shape_a, b.<span class="kw">id</span> id_b, b.shape shape_b </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> shape_a a <span class="kw">FULL</span> <span class="kw">JOIN</span> shape_b b <span class="kw">ON</span> a.shape <span class="op">=</span> b.shape;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="table">
<thead>
<tr class="header">
<th>id_a</th>
<th>shape_a</th>
<th>id_b</th>
<th>shape_b</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Trójkąt</td>
<td>2</td>
<td>Trójkąt</td>
</tr>
<tr class="even">
<td>2</td>
<td>Kwadrat</td>
<td>1</td>
<td>Kwadrat</td>
</tr>
<tr class="odd">
<td>3</td>
<td>Deltoid”</td>
<td>NULL</td>
<td>NULL</td>
</tr>
<tr class="even">
<td>4</td>
<td>Traper</td>
<td>NULL</td>
<td>NULL</td>
</tr>
<tr class="odd">
<td>NULL</td>
<td>NULL</td>
<td>3</td>
<td>Romb</td>
</tr>
<tr class="even">
<td>NULL</td>
<td>NULL</td>
<td>4</td>
<td>Równoległobok</td>
</tr>
</tbody>
</table>
</section>
</section>
</section>
<section id="podzapytania" class="level2">
<h2 class="anchored" data-anchor-id="podzapytania">Podzapytania</h2>
<p>Podzapytanie zagnieżdżone SELECT znajduje się wewnątrz zewnętrznego zapytania SELECT, np. po klauzuli WHERE, HAVING lub FROM. W przypadku tego rodzaju zapytań w pierwszej kolejności wykonywane są wewnętrzne zapytania SELECT, a ich wynik jest wykorzystywany do zewnętrznego zapytania SELECT. Stąd łatwo zuważyć, że mogą one służyć do poprawy wydajności obsługi zapytania. Należy dobierać podzapytania tak by najbardziej zagnieżdżone podzapytanie zawierało najmniejszy zbiór poszukiwań.</p>
<section id="przykład-5" class="level4">
<h4 class="anchored" data-anchor-id="przykład-5">Przykład:</h4>
<p>Jeżeli chcemy znaleźć w bazie informację o tytułach filmów zwróconych w zadanym okresie możemy wykonać następujące zapytanie:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> film_id, title <span class="kw">FROM</span> film </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> film_id <span class="kw">IN</span> ( </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">SELECT</span> inventory.film_id </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">FROM</span> rental <span class="kw">INNER</span> <span class="kw">JOIN</span> inventory <span class="kw">ON</span> inventory.inventory_id <span class="op">=</span> rental.inventory_id </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">WHERE</span> return_date <span class="kw">BETWEEN</span> <span class="st">'2005-05-29'</span> <span class="kw">AND</span> <span class="st">'2005-05-30'</span> </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="wynik-4" class="level4">
<h4 class="anchored" data-anchor-id="wynik-4">Wynik</h4>
<table class="table">
<thead>
<tr class="header">
<th>film_id</th>
<th>title</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>307</td>
<td>Fellowship Autumn</td>
</tr>
<tr class="even">
<td>255</td>
<td>Driving Polish</td>
</tr>
<tr class="odd">
<td>388</td>
<td>Gunfight Moon</td>
</tr>
<tr class="even">
<td>130</td>
<td>Celebrity Horn</td>
</tr>
<tr class="odd">
<td>563</td>
<td>Massacre Usual</td>
</tr>
<tr class="even">
<td>397</td>
<td>Hanky October</td>
</tr>
<tr class="odd">
<td>…</td>
<td>…</td>
</tr>
</tbody>
</table>
</section>
<section id="używanie-podzapytań" class="level3">
<h3 class="anchored" data-anchor-id="używanie-podzapytań">Używanie podzapytań</h3>
<p>Pod zapytania mogą być używane w : - SELECT, - UPDATE, - DELETE, - Funkcjach agregujących, - Do definiowania tabel tymczasowych.</p>
<p>Używając podzapytań zapytania SQL szybko mogą stać się mało czytelne. Przez co będą trudne w zrozumieniu i późniejszym utrzymaniu. W celu analizy zapytań można użyć klauzuli <strong>EXPLAIN</strong>, która przeanalizuje zapytanie. Klauzula ta może służyć również do porównywania wydajności zapytań</p>
<section id="przykład-6" class="level4">
<h4 class="anchored" data-anchor-id="przykład-6">Przykład:</h4>
<div class="sourceCode" id="cb11"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">EXPLAIN</span> <span class="kw">SELECT</span> \<span class="op">*</span> <span class="kw">FROM</span> film</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
</section>
<section id="funkcje-agregujące" class="level2">
<h2 class="anchored" data-anchor-id="funkcje-agregujące">Funkcje agregujące</h2>
<p>Funkcje agregujące wykonują obliczenia na zestawie wierszy i zwracają pojedynczy wiersz. PostgreSQL udostępnia wszystkie standardowe funkcje agregujące SQL w następujący sposób: - AVG () - zwraca średnią wartość. - COUNT () - zwraca liczbę wartości. - MAX () - zwraca maksymalną wartość. - MIN () - zwraca minimalną wartość. - SUM () - zwraca sumę wszystkich lub różnych wartości.</p>
<p>Pełna lista funkcji agregującej: <a href="https://www.postgresql.org/docs/9.5/functions-aggregate.html" class="uri">https://www.postgresql.org/docs/9.5/functions-aggregate.html</a></p>
<p>Często używamy funkcji agregujących z klauzulą GROUP BY w instrukcji SELECT. W tych przypadkach klauzula GROUP BY dzieli zestaw wyników na grupy wierszy i funkcja agregująca wykonuje obliczenia dla każdej grupy, np. maksimum, minimum, średnia itp. Funkcji agregujących można używać funkcji agregujących jako wyrażeń tylko w następujących klauzulach: SELECT i HAVING.</p>
<section id="group-by" class="level3">
<h3 class="anchored" data-anchor-id="group-by">GROUP BY</h3>
<p>Klauzula GROUP BY dzieli wiersze zwrócone z instrukcji SELECT na grupy. Dla każdej grupy można zastosować funkcję agregującą, np. SUM aby obliczyć sumę pozycji lub COUNT aby uzyskać liczbę elementów w grupach.</p>
<p>Poniższa instrukcja ilustruje składnię klauzuli GROUP BY:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> column_1, aggregate_function(column_2) <span class="kw">FROM</span> tbl_name <span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>column_1;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Klauzula GROUP BY musi pojawić się zaraz po klauzuli FROM lub WHERE, n0astępnie GROUP BY zawiera listę kolumna oddzielonych przecinkami.</p>
</section>
<section id="having" class="level3">
<h3 class="anchored" data-anchor-id="having">HAVING</h3>
<p>Często używamy klauzuli HAVING w połączeniu z klauzulą GROUP BY do filtrowania wierszy grup które nie spełniają określonego warunku.</p>
<p>Poniższa instrukcja ilustruje typową składnię klauzuli HAVING:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>column_1, aggregate_function (column_2) </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> tbl_name <span class="kw">GROUP</span> <span class="kw">BY</span> column_1</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="kw">HAVING</span> condition; </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Klauzula HAVING ustawia warunek dla wierszy grup utworzonych przez klauzulę GROUP BY po Klauzula GROUP BY ma zastosowanie, podczas gdy klauzula WHERE określa wcześniej warunki dla poszczególnych wierszy.</p>
</section>
</section>
<section id="testy-jednostkowe" class="level2">
<h2 class="anchored" data-anchor-id="testy-jednostkowe">Testy jednostkowe</h2>
<p>To laboratorium zostanie ocenione za pomocą testów jednostkowych wykonanych za pomocą bliblioteki <a href="https://testthat.r-lib.org/"><em>testthat</em></a>. Aby możliwe było ich uruchomienie należy zainstalować następujące pakiety:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="fu">c</span>(<span class="st">"devtools"</span>, <span class="st">"testthat"</span>, <span class="st">"knitr"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>UWAGA</strong>: Testy są skonstuowane tak by uruchamiały się za każdym razem gdy uruchamia się skrypt <em>main.R</em>. Z tego powodu nie można w nim edytować lini kodu które znajdują się pomiędzy znacznikami:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NIE EDYTOWAĆ *****************************************************************</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co">#*******************************************************************************</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Dodatkowo w obszarza zabronionym do edycji znajduje się połączenie do bazy danych które możńa używać w funkcjach do wykonania. Zabronine jest również przeprowadzanie zmian w katalogu <strong>tests</strong> i wszystkich podkatalogach.</p>
</section>
<section id="zadania" class="level2">
<h2 class="anchored" data-anchor-id="zadania">Zadania:</h2>
<p>Przygotuj implementację funkcji z pliku <strong>main.R</strong> i odpowiedź na pytania:</p>
<ol type="1">
<li>Znajdź listę wszystkich filmów o tej samej długości.</li>
<li>Znajdź wszystkich klientów mieszkających w tym samym mieście.</li>
<li>Oblicz średni koszt wypożyczenia wszystkich filmów.</li>
<li>Oblicz i wyświetl liczbę filmów we wszystkich kategoriach.</li>
<li>Wyświetl liczbę wszystkich klientów pogrupowanych według kraju.</li>
<li>Wyświetl informacje o sklepie, który ma więcej niż 100 klientów i mniej niż 300 klientów.</li>
<li>Wybierz wszystkich klientów, którzy oglądali filmy ponad 200 godzin.</li>
<li>Oblicz średnią wartość wypożyczenia filmu.</li>
<li>Oblicz średnią wartość długości filmu we wszystkich kategoriach.</li>
<li>Znajdź najdłuższe tytuły filmowe we wszystkich kategoriach.</li>
<li>Znajdź najdłuższy film we wszystkich kategoriach. Porównaj wynik z pkt 10.</li>
</ol>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>